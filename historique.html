<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>ToDoGolf Lab – Historique</title>
  <style>
    :root {
      --gap: 14px;
      --primary: #00503a;
      --bg: #050608;
      --card: #0f1419;
      --border: #182028;
      --text: #e7e8ea;
      --muted: #b8c0cc;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #06141a 0, #020309 55%, #000 100%);
      color: var(--text);
    }
    .hidden { display:none !important; }

    /* Topbar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(to bottom, rgba(5,6,8,0.96), rgba(5,6,8,0.88));
      border-bottom: 1px solid #10151e;
      padding: 10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      backdrop-filter: blur(14px);
      gap:8px;
    }
    .top-left {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand-dot {
      width:22px;
      height:22px;
      border-radius:999px;
      background:var(--primary);
      box-shadow:0 0 16px rgba(0,80,58,0.85);
    }
    .top-title {
      font-weight:600;
      font-size:16px;
    }
    .top-sub {
      font-size:11px;
      color:#8b9aaa;
    }

    .top-actions {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }
    .btn-top {
      border-radius:999px;
      border:1px solid #26303b;
      background:#0b1016;
      padding:6px 10px;
      font-size:12px;
      color:var(--text);
      cursor:pointer;
      text-decoration:none;
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .btn-top:hover { background:#101822; }

    .export-warning {
      font-size:11px;
      color:#fbbf24;
      background:rgba(251,191,36,0.06);
      border-radius:999px;
      border:1px solid rgba(251,191,36,0.4);
      padding:4px 8px;
      white-space:nowrap;
    }

    .wrap {
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px;
      padding-bottom: 40px;
    }

    .page-title {
      font-size:22px;
      font-weight:600;
      margin:10px 0 6px;
    }
    .page-subtitle {
      font-size:13px;
      color:#9aa5b1;
      margin-bottom:14px;
    }

    .layout {
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:16px;
    }

    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.4);
    }

    .card-title {
      font-size:15px;
      font-weight:600;
      margin-bottom:10px;
    }
    .card-subtitle {
      font-size:12px;
      color:#9aa5b1;
      margin-bottom:10px;
    }

    label {
      font-size: 12px;
      color:#b8c0cc;
      margin-bottom:4px;
      display:block;
    }
    input[type=text],
    input[type=number],
    input[type=date],
    select {
      width:100%;
      padding:8px 10px;
      border:1px solid #26303b;
      border-radius:10px;
      font-size:13px;
      background:#05080c;
      color:var(--text);
      margin-bottom:8px;
    }

    button {
      display:inline-block;
      text-align:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #26303b;
      background:#11171e;
      color:var(--text);
      font-weight:600;
      cursor:pointer;
      font-size:13px;
      white-space:nowrap;
    }
    button.primary {
      background:var(--primary);
      border-color:var(--primary);
      color:#fff;
      box-shadow:0 4px 12px rgba(0,80,58,0.45);
    }
    button.primary:hover {
      background:#046046;
    }
    button:disabled {
      opacity:0.55;
      cursor:not-allowed;
      box-shadow:none;
    }

    .filters-actions {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }

    table {
      width:100%;
      border-collapse: collapse;
      font-size:13px;
      margin-top:8px;
    }
    thead {
      background:#05080c;
    }
    th, td {
      padding:6px 8px;
      border-bottom:1px solid #202833;
      text-align:left;
      vertical-align:middle;
    }
    th {
      font-size:12px;
      color:#9aa5b1;
      text-transform:uppercase;
      letter-spacing:0.04em;
      cursor:pointer;
    }
    th.sort-asc::after {
      content:" ↑";
      font-size:10px;
      opacity:0.8;
    }
    th.sort-desc::after {
      content:" ↓";
      font-size:10px;
      opacity:0.8;
    }
    tbody tr:nth-child(even) {
      background:#0b1117;
    }

    .tag {
      display:inline-flex;
      align-items:center;
      border-radius:999px;
      padding:2px 8px;
      font-size:11px;
      background:#071015;
      border:1px solid #1c3b2f;
      color:#d1fae5;
    }

    .status-bar {
      font-size:12px;
      color:#9aa5b1;
      margin-top:6px;
    }

    .empty-state {
      font-size:13px;
      color:#9aa5b1;
      padding:8px 0;
    }

    .pagination {
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:#9aa5b1;
      gap:8px;
      flex-wrap:wrap;
    }
    .pagination-buttons {
      display:flex;
      gap:6px;
    }
    .pagination button {
      padding:4px 8px;
      font-size:12px;
    }

  </style>
</head>
<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="top-left">
      <div class="brand-dot"></div>
      <div>
        <div class="top-title">ToDoGolf Lab – Analyse & Performance</div>
        <div class="top-sub">Outils d’analyse pour vos radars papier</div>
      </div>
    </div>
    <div class="top-actions">
      <a href="index.html" class="btn-top">← Accueil</a>
      <span id="exportWarning" class="export-warning hidden">
        ⚠️ Des coups n’ont pas encore été exportés
      </span>
      <button id="btnImport" class="btn-top">⬆️ Importer CSV</button>
      <button id="btnExport" class="btn-top">⬇️ Exporter CSV</button>
      <input type="file" id="importInput" accept=".csv,text/csv" style="display:none;">
    </div>
  </header>

  <main class="wrap">
    <div class="page-title">Historique de vos coups</div>
    <div class="page-subtitle">
      Les données affichées ici proviennent de votre navigateur (<strong>localStorage</strong>).<br>
      Vous pouvez filtrer, trier, paginer, exporter ou réimporter vos coups depuis un autre appareil.
    </div>

    <div class="layout">
      <!-- Filtres -->
      <section class="card">
        <div class="card-title">Filtres</div>
        <div class="card-subtitle">
          Commencez par choisir un type de session, puis ajustez les autres critères et cliquez sur « Appliquer les filtres ».
        </div>

        <!-- Type de session (Parcours ou Practice) -->
        <label for="fSessionType">Type de session</label>
        <select id="fSessionType">
          <option value="all">— Choisissez un type —</option>
          <option value="parcours">Parcours</option>
          <option value="practice">Practice</option>
        </select>

        <!-- Session spécifique (filtrage par texte libre) -->
        <label for="fSession">Session</label>
        <input type="text" id="fSession" placeholder="Rechercher par nom de session">

        <label for="fDateFrom">Date min</label>
        <input type="date" id="fDateFrom">

        <label for="fDateTo">Date max</label>
        <input type="date" id="fDateTo">

        <label for="fClub">Club</label>
        <select id="fClub">
          <option value="">Tous les clubs</option>
        </select>

        <label for="fDistMin">Distance cible min (m)</label>
        <input type="number" id="fDistMin" placeholder="ex: 50">

        <label for="fDistMax">Distance cible max (m)</label>
        <input type="number" id="fDistMax" placeholder="ex: 120">

        <div class="filters-actions">
          <button id="btnApply" class="primary" type="button">Appliquer les filtres</button>
          <button id="btnReset" type="button">Réinitialiser</button>
        </div>

        <div id="filterInfo" class="status-bar"></div>
      </section>

      <!-- Résultats -->
      <section class="card">
        <div class="card-title">Vue des données</div>

        <!-- Vue Données brutes -->
        <div id="viewRaw">
          <div class="card-subtitle">
            Chaque ligne correspond à un coup enregistré dans votre historique.
          </div>

          <div id="rawTableContainer">
            <table>
              <thead>
                <tr>
                  <th data-sort="date">Date</th>
                  <th data-sort="club">Club</th>
                  <th data-sort="dist_cible">Dist. cible</th>
                  <th data-sort="radar">Radar</th>
                  <th data-sort="dist_totale">Dist. totale</th>
                  <th data-sort="lat">Écart lat.</th>
                  <th data-sort="prof">Écart prof.</th>
                  <th data-sort="none"></th>
                </tr>
              </thead>
              <tbody id="rawBody">
                <tr><td colspan="8" class="empty-state">Chargement…</td></tr>
              </tbody>
            </table>
          </div>

          <div class="pagination">
            <div id="paginationInfo">Page 1 / 1</div>
            <div class="pagination-buttons">
              <button id="prevPageBtn" type="button">Précédent</button>
              <button id="nextPageBtn" type="button">Suivant</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Popup suppression -->
  <div id="deletePopup" class="delete-popup-overlay hidden">
    <div class="delete-popup-card">
      <div class="delete-title">Supprimer ce coup ?</div>
      <div class="delete-text">
        Êtes-vous sûr de vouloir supprimer ce coup de votre historique ?<br>
        Cette action est définitive.
      </div>
      <div class="delete-actions">
        <button id="deleteCancelBtn" class="btn-ghost" type="button">Annuler</button>
        <button id="deleteConfirmBtn" class="primary" type="button">Oui, supprimer</button>
      </div>
    </div>
  </div>

  <script>
    const RENDER_URL = "https://todogolf-analyse.onrender.com/";

    function pingRender() {
      try {
        fetch(RENDER_URL, {
          method: "HEAD",
          mode: "no-cors"
        }).catch(() => {});
      } catch (e) {}
    }

    pingRender();
    setInterval(pingRender, 5 * 60 * 1000);
  </script>
</body>
</html>
